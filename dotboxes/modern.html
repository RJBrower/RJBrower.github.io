<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Dots & Boxes â€” Perfect Alignment with Board Size</title>
<style>
:root{
  --bg: #0b0f13;
  --fg: #f6f7f9;
  --muted: #9aa3ad;
  --dot-size: 12px;
  --line-thick: 4px;
  --hit-size: 40px;
  --fill-opacity: 0.85;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
.app{display:flex;flex-direction:column;align-items:stretch;gap:10px;padding:12px;min-height:100vh}

.menu{max-width:980px;margin:0 auto;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.menu label{color:var(--muted);font-size:13px}
input[type=number], select{background:#0f1417;border:1px solid #111;padding:8px;border-radius:8px;color:var(--fg);min-width:84px}
button{background:#2b6cff;color:white;border:0;padding:9px 12px;border-radius:8px;cursor:pointer;font-weight:600}

.topbar{display:flex;justify-content:space-between;align-items:center;gap:10px;max-width:980px;margin:0 auto}
.badge{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.03);font-weight:600}

#boardWrap{ display:flex;justify-content:center; align-items:center; width:100%; flex:1; min-height:0; position:relative }
#board {
  position:relative;
  background:transparent;
  transform-origin: top left;
}

.dot{
  position:absolute;
  border-radius:50%;
  background:var(--fg);
  z-index:40;
  box-shadow:0 0 0 3px rgba(0,0,0,0.25) inset;
}

.box{
  position:absolute;
  z-index:10;
  transition:background .12s ease;
}

.edge-line{
  position:absolute;
  z-index:30;
  pointer-events:none;
  background:transparent;
  transition:background .12s ease;
  border-radius:999px;
}

.edge-hit{
  position:absolute;
  z-index:50;
  background:transparent;
  touch-action: manipulation;
  cursor:pointer;
}

#overlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.55); z-index:9999 }
.panel{ background:#091219; border-radius:12px; padding:16px; min-width:260px; color:var(--fg); box-shadow:0 10px 30px rgba(0,0,0,0.6) }
.panel h3{margin:0 0 8px 0;font-size:18px}
.results{ display:flex; flex-direction:column; gap:8px; margin:8px 0 12px 0 }
.resultRow{ display:flex; justify-content:space-between; gap:8px; align-items:center }
.small{ font-size:13px; color:var(--muted) }

@media (max-width:520px){
  :root{ --dot-size: 10px; --line-thick: 3px; --hit-size: 36px; }
}
</style>
</head>
<body>
<div class="app">

  <div class="menu" id="menu">
    <label>Rows (dots)
      <input id="rowsInput" type="number" min="3" max="30" value="11" />
    </label>
    <label>Cols (dots)
      <input id="colsInput" type="number" min="3" max="30" value="6" />
    </label>
    <label>Players
      <select id="playersInput"></select>
    </label>
    <button id="startBtn">Start</button>
  </div>

  <div id="topbar" class="topbar" style="display:none;">
    <div class="badge" id="turnBadge">Turn: P1 | 11x6</div>
    <div style="display:flex;gap:8px;align-items:center;">
      <div id="liveScores" style="display:flex;gap:10px;align-items:center"></div>
      <button id="resetBtn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--fg);padding:8px;border-radius:8px">Change</button>
    </div>
  </div>

  <div id="boardWrap">
    <div id="board"></div>
  </div>

</div>

<div id="overlay">
  <div class="panel">
    <h3>Game Over</h3>
    <div class="results" id="resultsList"></div>
    <div style="display:flex;justify-content:flex-end;gap:8px;">
      <button id="closeOverlay" style="padding:8px 10px;border-radius:8px;background:#2b6cff;color:#fff;border:0">Close</button>
      <button id="playAgain" style="padding:8px 10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--fg)">Play again</button>
    </div>
  </div>
</div>

<script>
const PLAYER_HEX = ['#ff5252','#4cc9f0','#ffd166','#06d6a0','#f08cec','#ff8b3d','#bde0fe','#c78cff'];
const FILL_OPACITY = 0.85;

const rowsInput = document.getElementById('rowsInput');
const colsInput = document.getElementById('colsInput');
const playersInput = document.getElementById('playersInput');
const startBtn = document.getElementById('startBtn');
const menu = document.getElementById('menu');
const board = document.getElementById('board');
const boardWrap = document.getElementById('boardWrap');
const topbar = document.getElementById('topbar');
const turnBadge = document.getElementById('turnBadge');
const liveScores = document.getElementById('liveScores');
const resetBtn = document.getElementById('resetBtn');
const overlay = document.getElementById('overlay');
const resultsList = document.getElementById('resultsList');
const closeOverlay = document.getElementById('closeOverlay');
const playAgain = document.getElementById('playAgain');

let R=11,C=6,N=2;
let players=[],turn=0,hEdges=[],vEdges=[],boxes=[],remainingEdges=0;

(function init(){
  for(let i=2;i<=8;i++){
    const opt=document.createElement('option');
    opt.value=i; opt.textContent=i;
    playersInput.appendChild(opt);
  }
  playersInput.value='2';
})();

function makePlayers(n){
  return Array.from({length:n},(_,i)=>{
    const color = PLAYER_HEX[i%PLAYER_HEX.length];
    return {name:`P${i+1}`,color,fill:hexToRgba(color,FILL_OPACITY),score:0};
  });
}
function hexToRgba(hex,a){
  const h=hex.replace('#',''),v=parseInt(h,16);
  const r=(v>>16)&255,g=(v>>8)&255,b=v&255;
  return `rgba(${r},${g},${b},${a})`;
}

startBtn.addEventListener('click',()=>{
  R=Math.max(3,Math.min(30,parseInt(rowsInput.value)||11));
  C=Math.max(3,Math.min(30,parseInt(colsInput.value)||6));
  N=Math.max(2,Math.min(8,parseInt(playersInput.value)||2));
  players=makePlayers(N);
  players.forEach(p=>p.score=0);
  turn=0;
  menu.style.display='none';
  topbar.style.display='flex';
  buildBoard();
});

resetBtn.addEventListener('click',()=>{
  menu.style.display='';
  topbar.style.display='none';
  board.innerHTML='';
  overlay.style.display='none';
});

function buildBoard(){
  board.innerHTML='';
  const bw = boardWrap.clientWidth;
  const bh = boardWrap.clientHeight;
  const unit = Math.min(bw/(C-1), bh/(R-1));
  board.style.width = (C-1)*unit + 'px';
  board.style.height = (R-1)*unit + 'px';
  const dotSize = unit*0.25;
  const lineThick = unit*0.09;
  const hitSize = unit*1.2;
  document.documentElement.style.setProperty('--dot-size',dotSize+'px');
  document.documentElement.style.setProperty('--line-thick',lineThick+'px');
  document.documentElement.style.setProperty('--hit-size',hitSize+'px');

  hEdges=Array.from({length:R},()=>Array(C-1).fill(0));
  vEdges=Array.from({length:R-1},()=>Array(C).fill(0));
  boxes=Array.from({length:R-1},()=>Array(C-1).fill(null));
  remainingEdges=R*(C-1)+(R-1)*C;

  // boxes
  for(let r=0;r<R-1;r++){
    for(let c=0;c<C-1;c++){
      const b=document.createElement('div'); b.className='box';
      b.style.width=b.style.height=unit+'px';
      b.style.left = c*unit+'px';
      b.style.top  = r*unit+'px';
      b.dataset.r=r; b.dataset.c=c;
      board.appendChild(b);
    }
  }

  // horizontal lines
  for(let r=0;r<R;r++){
    for(let c=0;c<C-1;c++){
      createEdge(c*unit, r*unit, unit, lineThick, 'H', r, c);
    }
  }

  // vertical lines
  for(let r=0;r<R-1;r++){
    for(let c=0;c<C;c++){
      createEdge(c*unit, r*unit, lineThick, unit, 'V', r, c);
    }
  }

  // dots
  for(let r=0;r<R;r++){
    for(let c=0;c<C;c++){
      const d=document.createElement('div'); d.className='dot';
      d.style.width=d.style.height=dotSize+'px';
      d.style.left=c*unit-dotSize/2+'px';
      d.style.top =r*unit-dotSize/2+'px';
      board.appendChild(d);
    }
  }

  updateHUD();
}

function createEdge(x,y,w,h,type,r,c){
  const line=document.createElement('div'); line.className='edge-line';
  if(type==='H'){
    line.style.width = w + 'px';
    line.style.height = h + 'px';
    line.style.left = x + 'px';
    line.style.top = y - h/2 + 'px';
  } else {
    line.style.width = w + 'px';
    line.style.height = h + 'px';
    line.style.left = x - w/2 + 'px';
    line.style.top = y + 'px';
  }
  board.appendChild(line);

  const hit=document.createElement('div'); hit.className='edge-hit';
  hit.style.width = w*1.2 + 'px';
  hit.style.height = h*1.2 + 'px';
  hit.style.left = (type==='H'? x - w*0.1 : x - w*0.6) + 'px';
  hit.style.top  = (type==='H'? y - h*0.6 : y - h*0.1) + 'px';
  hit.addEventListener('click',()=>onEdgeClick(type,r,c,line));
  board.appendChild(hit);
}

function onEdgeClick(type,r,c,line){
  if(type==='H'){ if(hEdges[r][c]) return; hEdges[r][c]=turn+1; }
  else{ if(vEdges[r][c]) return; vEdges[r][c]=turn+1; }
  remainingEdges--;
  line.style.background=players[turn].color;
  line.style.boxShadow='0 0 8px '+players[turn].color+'55';

  let got=false;
  const touched=boxesAdjacent(type,r,c);
  for(const [br,bc] of touched){
    if(boxes[br][bc]===null && isComplete(br,bc)){
      boxes[br][bc]=turn;
      players[turn].score++;
      paintBox(br,bc,players[turn].fill);
      got=true;
    }
  }

  if(!got) turn=(turn+1)%players.length;
  updateHUD();
  if(remainingEdges===0) showResults();
}

function boxesAdjacent(type,r,c){
  const list=[];
  if(type==='H'){
    if(r-1>=0 && c<C-1) list.push([r-1,c]);
    if(r<R-1 && c<C-1) list.push([r,c]);
  } else {
    if(c-1>=0 && r<R-1) list.push([r,c-1]);
    if(c<C-1 && r<R-1) list.push([r,c]);
  }
  return list;
}

function isComplete(br,bc){
  return !!(hEdges[br][bc] && hEdges[br+1][bc] && vEdges[br][bc] && vEdges[br][bc+1]);
}

function paintBox(r,c,fill){
  const b=[...board.querySelectorAll('.box')].find(el=>el.dataset.r==r && el.dataset.c==c);
  if(b){ b.style.background=fill; b.style.opacity=FILL_OPACITY; }
}

function updateHUD(){
  turnBadge.textContent = `Turn: ${players[turn].name} | ${R}x${C}`;
  liveScores.innerHTML='';
  players.forEach(p=>{
    const wrapper=document.createElement('div'); wrapper.style.display='flex'; wrapper.style.gap='8px'; wrapper.style.alignItems='center';
    const dot=document.createElement('div'); dot.style.width=dot.style.height='12px'; dot.style.borderRadius='50%'; dot.style.background=p.color; dot.style.boxShadow='0 0 0 2px rgba(0,0,0,0.25) inset';
    const txt=document.createElement('div'); txt.style.fontSize='13px'; txt.textContent=`${p.name}: ${p.score}`;
    wrapper.appendChild(dot); wrapper.appendChild(txt); liveScores.appendChild(wrapper);
  });
}

function showResults(){
  const sorted=players.map((p,i)=>({i,name:p.name,score:p.score,color:p.color})).sort((a,b)=>b.score-a.score);
  resultsList.innerHTML='';
  sorted.forEach(s=>{
    const row=document.createElement('div'); row.className='resultRow'; row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center';
    const left=document.createElement('div'); left.style.display='flex'; left.style.alignItems='center'; left.style.gap='8px';
    const dot=document.createElement('div'); dot.style.width=dot.style.height='14px'; dot.style.borderRadius='50%'; dot.style.background=s.color;
    const name=document.createElement('div'); name.textContent=s.name;
    left.appendChild(dot); left.appendChild(name);
    const score=document.createElement('div'); score.textContent=s.score;
    row.appendChild(left); row.appendChild(score); resultsList.appendChild(row);
  });
  overlay.style.display='flex';
}

closeOverlay.addEventListener('click',()=>overlay.style.display='none');
playAgain.addEventListener('click',()=>{overlay.style.display='none'; resetBtn.click();});
</script>
</body>
</html>